<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Оформление заказа - ТехноДом</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
<header>
    <div class="container header-container">
        <div class="logo">
            <a href="../index.html">
                <i class="fas fa-home"></i>
                <span>ТехноДом</span>
            </a>
        </div>
        
        <nav>
            <ul>
                <li><a href="../index.html"><i class="fas fa-home"></i> Главная</a></li>
                <li><a href="../pages/catalog.html"><i class="fas fa-list"></i> Каталог</a></li>
                <li><a href="../pages/delivery.html"><i class="fas fa-truck"></i> Доставка</a></li>
                <li><a href="../pages/contacts.html"><i class="fas fa-phone"></i> Контакты</a></li>
                <li><a href="../pages/faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
                <li><a href="../pages/about.html"><i class="fas fa-info-circle"></i> О нас</a></li>
                <li><a href="../pages/cart.html"><i class="fas fa-shopping-cart"></i> Корзина <span class="cart-count">0</span></a></li>
                <li><a href="../pages/favorites.html"><i class="fas fa-heart"></i> Избранное <span class="fav-count">0</span></a></li>
                <li><a href="../pages/account.html"><i class="fas fa-user"></i> Кабинет</a></li>
                <li><a href="../pages/admin.html"><i class="fas fa-cog"></i> Админка</a></li>
            </ul>
        </nav>
        
        <div class="mobile-menu-btn">
            <i class="fas fa-bars"></i>
        </div>
    </div>
</header>
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
</div>

<div class="notification" id="notification"></div>

<div class="step-progress">
    <div class="step-progress-bar" id="stepProgressBar"></div>
</div>
    <main class="container">
        <div class="checkout-steps">
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <div class="step-text">Данные покупателя</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-text">Способ оплаты</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div class="step-text">Подтверждение</div>
            </div>
        </div>
        
        <div class="checkout-container">
            <div class="checkout-form-section" id="customer-data">
                <h2>Данные покупателя</h2>
                
                <div class="checkout-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Имя *</label>
                            <input type="text" id="checkout-firstname" required>
                        </div>
                        <div class="form-group">
                            <label>Фамилия *</label>
                            <input type="text" id="checkout-lastname" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="checkout-email" required>
                        </div>
                        <div class="form-group">
                            <label>Телефон *</label>
                            <input type="tel" id="checkout-phone" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Адрес доставки</label>
                        <textarea id="checkout-address" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Комментарий к заказу</label>
                        <textarea id="checkout-comment" rows="3" placeholder="Дополнительные пожелания..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <a href="../pages/cart.html" class="btn-outline">Вернуться в корзину</a>
                        <button class="btn-primary" onclick="goToPayment()">Перейти к оплате</button>
                    </div>
                </div>
            </div>
            
            <div class="checkout-summary">
                <h3>Ваш заказ</h3>
                <div class="checkout-items" id="checkout-items">
                    <!-- Товары загружаются через JS -->
                </div>
                
                <div class="checkout-totals">
                    <div class="total-row">
                        <span>Товары</span>
                        <span id="subtotal-checkout">0 ₽</span>
                    </div>
                    <div class="total-row">
                        <span>Доставка</span>
                        <span id="delivery-checkout">0 ₽</span>
                    </div>
                    <div class="total-row">
                        <span>Скидка</span>
                        <span id="discount-checkout">0 ₽</span>
                    </div>
                    <div class="total-row total-final">
                        <span>Итого к оплате</span>
                        <span id="total-checkout">0 ₽</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Шаг оплаты -->
        <div class="checkout-form-section" id="payment-section" style="display: none;">
            <h2>Выберите способ оплаты</h2>
            
            <div class="payment-methods">
                <div class="payment-method">
                    <input type="radio" name="payment" id="card-payment" checked>
                    <label for="card-payment">
                        <i class="fas fa-credit-card"></i>
                        <div>
                            <h4>Банковская карта</h4>
                            <p>Оплата онлайн банковской картой</p>
                        </div>
                    </label>
                </div>
                
                <div class="payment-method">
                    <input type="radio" name="payment" id="cash-payment">
                    <label for="cash-payment">
                        <i class="fas fa-money-bill-wave"></i>
                        <div>
                            <h4>Наличными при получении</h4>
                            <p>Оплата курьеру при доставке</p>
                        </div>
                    </label>
                </div>
                
                <div class="payment-method">
                    <input type="radio" name="payment" id="installment-payment">
                    <label for="installment-payment">
                        <i class="fas fa-calendar-alt"></i>
                        <div>
                            <h4>Рассрочка</h4>
                            <p>Рассрочка 0% на 12 месяцев</p>
                        </div>
                    </label>
                </div>
            </div>
            
            <!-- Форма оплаты картой -->
            <div class="card-payment-form" id="card-form">
                <h3>Данные карты</h3>
                
                <div class="form-group">
                    <label>Номер карты</label>
                    <input type="text" id="card-number" placeholder="0000 0000 0000 0000" maxlength="19">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Срок действия</label>
                        <input type="text" id="card-expiry" placeholder="ММ/ГГ" maxlength="5">
                    </div>
                    <div class="form-group">
                        <label>CVV/CVC</label>
                        <input type="text" id="card-cvv" placeholder="123" maxlength="3">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Имя держателя карты</label>
                    <input type="text" id="card-holder" placeholder="IVAN IVANOV">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="save-card"> Сохранить карту для будущих покупок
                    </label>
                </div>
            </div>
            
            <div class="form-actions">
                <button class="btn-outline" onclick="backToCustomerData()">Назад</button>
                <button class="btn-primary" onclick="processPayment()">Оплатить</button>
            </div>
        </div>
        
        <!-- Подтверждение заказа -->
        <div class="order-confirmation" id="confirmation-section" style="display: none;">
            <div class="confirmation-content">
                <div class="confirmation-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                
                <h2>Заказ успешно оформлен!</h2>
                
                <div class="order-details">
                    <p><strong>Номер заказа:</strong> <span id="order-number">000001</span></p>
                    <p><strong>Сумма:</strong> <span id="order-total">0 ₽</span></p>
                    <p><strong>Способ оплаты:</strong> <span id="order-payment">Банковская карта</span></p>
                    <p><strong>Статус:</strong> <span class="status processing">В обработке</span></p>
                </div>
                
                <p>На ваш email отправлено подтверждение заказа. Мы свяжемся с вами для уточнения деталей доставки.</p>
                
                <div class="confirmation-actions">
                    <a href="../index.html" class="btn-primary">Вернуться на главную</a>
                    <a href="../pages/account.html#orders" class="btn-outline">Мои заказы</a>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container footer-container">
            <div class="footer-section">
                <h3>ТехноДом</h3>
                <p>Магазин качественной бытовой техники с 2010 года</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-vk"></i></a>
                    <a href="#"><i class="fab fa-telegram"></i></a>
                    <a href="#"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Покупателям</h3>
                <ul>
                    <li><a href="../pages/catalog.html">Каталог</a></li>
                    <li><a href="../pages/delivery.html">Доставка и оплата</a></li>
                    <li><a href="../pages/faq.html">Вопросы и ответы</a></li>
                    <li><a href="../pages/contacts.html">Контакты</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Контакты</h3>
                <p><i class="fas fa-phone"></i> 8 (800) 123-45-67</p>
                <p><i class="fas fa-envelope"></i> info@technodom.ru</p>
                <p><i class="fas fa-map-marker-alt"></i> Москва, ул. Техническая, 15</p>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2024 ТехноДом. Все права защищены.</p>
        </div>
    </footer>

    <script src="../js/script.js"></script>
    <script>
    // Проверка, что все работает
    console.log('Checkout page loaded');
    
    // Данные для оформления заказа
    let checkoutData = {
        customer: {},
        payment: {},
        order: {}
    };
    
    document.addEventListener('DOMContentLoaded', function() {
        // Инициализация страницы оформления
        initCheckoutPage();
    });
    
    function initCheckoutPage() {
        // Загрузка данных пользователя если он авторизован
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (currentUser) {
            const nameParts = currentUser.name ? currentUser.name.split(' ') : [];
            document.getElementById('checkout-firstname').value = nameParts[0] || currentUser.firstname || '';
            document.getElementById('checkout-lastname').value = nameParts[1] || currentUser.lastname || '';
            document.getElementById('checkout-email').value = currentUser.email || '';
            document.getElementById('checkout-phone').value = currentUser.phone || '';
            document.getElementById('checkout-address').value = currentUser.address || '';
        }
        
        // Проверяем, есть ли товары в корзине
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        if (cart.length === 0) {
            setTimeout(() => {
                if (confirm('Ваша корзина пуста. Перейти к покупкам?')) {
                    window.location.href = 'catalog.html';
                }
            }, 500);
            return;
        }
        
        // Загружаем данные корзины
        loadCheckoutData();
    }
    
    function loadCheckoutData() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const products = JSON.parse(localStorage.getItem('products')) || getDefaultProducts();
        const container = document.getElementById('checkout-items');
        
        if (!container) return;
        
        let subtotal = 0;
        let itemsHtml = '';
        
        cart.forEach(item => {
            const product = products.find(p => p.id === item.productId);
            if (product) {
                const itemTotal = product.price * item.quantity;
                subtotal += itemTotal;
                
                itemsHtml += `
                    <div class="checkout-item">
                        <div class="item-image">
                            <img src="${product.image}" alt="${product.name}">
                        </div>
                        <div class="item-details">
                            <h4>${product.name}</h4>
                            <div class="item-price">${product.price.toLocaleString()} ₽ × ${item.quantity}</div>
                        </div>
                        <div class="item-total">${itemTotal.toLocaleString()} ₽</div>
                    </div>
                `;
            }
        });
        
        container.innerHTML = itemsHtml;
        
        // Расчет итогов
        const freeDeliveryThreshold = 20000;
        let deliveryCost = subtotal >= freeDeliveryThreshold ? 0 : 500;
        
        // Проверка промокода
        const promoCode = localStorage.getItem('activePromoCode');
        let discount = 0;
        
        if (promoCode === 'TECHNO10' && subtotal > 0) {
            discount = subtotal * 0.1;
        } else if (promoCode === 'WELCOME500' && subtotal > 0) {
            discount = 500;
        }
        
        const total = subtotal + deliveryCost - discount;
        
        // Обновление сумм
        document.getElementById('subtotal-checkout').textContent = subtotal.toLocaleString() + ' ₽';
        document.getElementById('delivery-checkout').textContent = 
            deliveryCost === 0 ? 'Бесплатно' : deliveryCost.toLocaleString() + ' ₽';
        document.getElementById('discount-checkout').textContent = 
            discount > 0 ? '-' + discount.toLocaleString() + ' ₽' : '0 ₽';
        document.getElementById('total-checkout').textContent = total.toLocaleString() + ' ₽';
        
        checkoutData.order = {
            subtotal,
            delivery: deliveryCost,
            discount,
            total
        };
    }
    
    function goToPayment() {
        // Сбор данных покупателя
        const customer = {
            firstname: document.getElementById('checkout-firstname').value,
            lastname: document.getElementById('checkout-lastname').value,
            email: document.getElementById('checkout-email').value,
            phone: document.getElementById('checkout-phone').value,
            address: document.getElementById('checkout-address').value,
            comment: document.getElementById('checkout-comment').value,
            date: new Date().toLocaleDateString('ru-RU')
        };
        
        // Проверка обязательных полей
        if (!customer.firstname || !customer.lastname || !customer.email || !customer.phone) {
            alert('Пожалуйста, заполните все обязательные поля: имя, фамилия, email и телефон');
            return;
        }
        
        // Проверка email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(customer.email)) {
            alert('Пожалуйста, введите корректный email адрес');
            return;
        }
        
        checkoutData.customer = customer;
        
        // Переход к оплате
        document.getElementById('customer-data').style.display = 'none';
        document.getElementById('payment-section').style.display = 'block';
        
        // Обновление шагов
        updateSteps(2);
    }
    
    function backToCustomerData() {
        document.getElementById('payment-section').style.display = 'none';
        document.getElementById('customer-data').style.display = 'block';
        
        updateSteps(1);
    }
    
    function processPayment() {
        // Сбор данных оплаты
        const paymentMethod = document.querySelector('input[name="payment"]:checked');
        if (!paymentMethod) {
            alert('Пожалуйста, выберите способ оплаты');
            return;
        }
        
        const paymentData = {
            method: paymentMethod.id.replace('-payment', ''),
            type: 'simulated'
        };
        
        // Если выбрана карта, проверяем данные карты
        if (paymentMethod.id === 'card-payment') {
            const cardNumber = document.getElementById('card-number')?.value.replace(/\s+/g, '') || '';
            const cardExpiry = document.getElementById('card-expiry')?.value || '';
            const cardCVV = document.getElementById('card-cvv')?.value || '';
            const cardHolder = document.getElementById('card-holder')?.value || '';
            
            if (!cardNumber || !cardExpiry || !cardCVV || !cardHolder) {
                alert('Пожалуйста, заполните все поля данных карты');
                return;
            }
            
            if (cardNumber.replace(/\s/g, '').length !== 16) {
                alert('Номер карты должен содержать 16 цифр');
                return;
            }
            
            if (cardCVV.length !== 3) {
                alert('CVV код должен содержать 3 цифры');
                return;
            }
            
            paymentData.card = {
                last4: cardNumber.slice(-4),
                holder: cardHolder
            };
        }
        
        checkoutData.payment = paymentData;
        
        // Показываем загрузку
        const payButton = document.querySelector('.btn-primary[onclick="processPayment()"]');
        const originalText = payButton.innerHTML;
        payButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Обработка...';
        payButton.disabled = true;
        
        // Имитация обработки платежа (3 секунды)
        setTimeout(() => {
            createOrder();
            payButton.innerHTML = originalText;
            payButton.disabled = false;
        }, 3000);
    }
    
    function createOrder() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const products = JSON.parse(localStorage.getItem('products')) || getDefaultProducts();
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        
        // Проверяем корзину
        if (cart.length === 0) {
            alert('Корзина пуста!');
            window.location.href = 'cart.html';
            return;
        }
        
        // Проверяем наличие товаров
        let items = [];
        let subtotal = 0;
        let stockErrors = [];
        
        cart.forEach(item => {
            const product = products.find(p => p.id === item.productId);
            if (product) {
                // Проверяем наличие
                if (product.inStock === false || (product.stock && product.stock < item.quantity)) {
                    stockErrors.push({
                        name: product.name,
                        requested: item.quantity,
                        available: product.stock || 0
                    });
                    return;
                }
                
                const itemTotal = product.price * item.quantity;
                subtotal += itemTotal;
                
                items.push({
                    productId: item.productId,
                    name: product.name,
                    price: product.price,
                    quantity: item.quantity,
                    image: product.image
                });
                
                // Уменьшаем количество на складе
                if (product.stock !== undefined) {
                    product.stock -= item.quantity;
                    if (product.stock <= 0) {
                        product.inStock = false;
                    }
                }
            }
        });
        
        // Если есть ошибки с количеством
        if (stockErrors.length > 0) {
            let errorMessage = 'Недостаточно товара на складе:\n';
            stockErrors.forEach(error => {
                errorMessage += `- ${error.name}: доступно ${error.available}, запрошено ${error.requested}\n`;
            });
            alert(errorMessage);
            return;
        }
        
        // Создание заказа
        const order = {
            id: Date.now(),
            customer: checkoutData.customer,
            payment: checkoutData.payment,
            items: items,
            subtotal: subtotal,
            delivery: checkoutData.order.delivery,
            discount: checkoutData.order.discount,
            total: checkoutData.order.total,
            status: 'processing',
            date: new Date().toLocaleDateString('ru-RU'),
            time: new Date().toLocaleTimeString('ru-RU'),
            userId: currentUser ? currentUser.id : null
        };
        
        // Сохранение заказа
        const orders = JSON.parse(localStorage.getItem('orders')) || [];
        orders.push(order);
        localStorage.setItem('orders', JSON.stringify(orders));
        
        // Сохранение обновленных товаров
        localStorage.setItem('products', JSON.stringify(products));
        
        // Очистка корзины
        localStorage.removeItem('cart');
        localStorage.removeItem('activePromoCode');
        
        // Обновление счетчика корзины
        updateCartCount();
        
        // Показ подтверждения
        showConfirmation(order);

        // После успешного создания заказа
    showConfirmation(order);
    
    // Добавить автоматическое обновление интерфейса
    setTimeout(() => {
        // Обновляем счетчики
        updateCartCount();
        updateFavCount();
        
        // Показываем дополнительное сообщение
        const confirmationMsg = document.querySelector('.confirmation-message');
        if (confirmationMsg) {
            confirmationMsg.innerHTML += `
                <p><strong>Данные обновлены:</strong></p>
                <p>• Статистика профиля обновлена</p>
                <p>• Админ-панель синхронизирована</p>
                <p>• Остатки товаров изменены</p>
            `;
        }
    }, 1000);
    }
    
    function showConfirmation(order) {
        document.getElementById('payment-section').style.display = 'none';
        document.getElementById('confirmation-section').style.display = 'block';
        
        // Заполнение данных заказа
        document.getElementById('order-number').textContent = order.id;
        document.getElementById('order-total').textContent = order.total.toLocaleString() + ' ₽';
        
        const paymentMethods = {
            'card': 'Банковская карта',
            'cash': 'Наличными при получении',
            'installment': 'Рассрочка'
        };
        
        document.getElementById('order-payment').textContent = 
            paymentMethods[order.payment.method] || order.payment.method;
        
        updateSteps(3);
        
        // Обновление статистики
        const stats = JSON.parse(localStorage.getItem('storeStats')) || {
            totalOrders: 0,
            totalRevenue: 0
        };
        
        stats.totalOrders += 1;
        stats.totalRevenue += order.total;
        
        localStorage.setItem('storeStats', JSON.stringify(stats));
    }
    
function updateSteps(step) {
    // Убираем все классы
    document.getElementById('step1').className = 'step';
    document.getElementById('step2').className = 'step';
    document.getElementById('step3').className = 'step';
    
    // Устанавливаем активный шаг
    if (step >= 1) document.getElementById('step1').classList.add('completed');
    if (step >= 2) document.getElementById('step2').classList.add('completed');
    if (step >= 3) document.getElementById('step3').classList.add('completed');
    
    // Активный шаг
    if (step >= 1 && step < 2) document.getElementById('step1').classList.add('active');
    if (step >= 2 && step < 3) document.getElementById('step2').classList.add('active');
    if (step >= 3) document.getElementById('step3').classList.add('active');
}
    
    // Форматирование номера карты
    document.getElementById('card-number')?.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
        let matches = value.match(/\d{4,16}/g);
        let match = matches && matches[0] || '';
        let parts = [];
        
        for (let i = 0; i < match.length; i += 4) {
            parts.push(match.substring(i, i + 4));
        }
        
        if (parts.length) {
            e.target.value = parts.join(' ');
        } else {
            e.target.value = value;
        }
    });
    
    // Форматирование срока действия
    document.getElementById('card-expiry')?.addEventListener('input', function(e) {
        let value = e.target.value.replace(/[^0-9]/g, '');
        if (value.length >= 2) {
            e.target.value = value.substring(0, 2) + '/' + value.substring(2, 4);
        }
    });
    
    // Только цифры для CVV
    document.getElementById('card-cvv')?.addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
    });
    
    // Только буквы для имени держателя
    document.getElementById('card-holder')?.addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/[^a-zA-Zа-яА-Я\s]/g, '');
    });

    function updateSteps(step) {
    const steps = document.querySelectorAll('.step');
    const progressBar = document.getElementById('stepProgressBar');
    
    steps.forEach((s, index) => {
        s.classList.remove('active', 'completed');
        if (index < step) {
            s.classList.add('completed');
        }
        if (index === step - 1) {
            s.classList.add('active');
        }
    });
    
    if (progressBar) {
        progressBar.className = 'step-progress-bar';
        progressBar.classList.add(`step-${step}`);
    }
}
</script>
    
    <style>
    /* Дополнительные стили для оформления заказа */
    
    /* Стили для полей формы */
    .form-group {
        margin-bottom: 25px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--dark);
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid var(--light);
        border-radius: var(--border-radius);
        font-size: 1rem;
        transition: var(--transition);
        background: white;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
        outline: none;
        border-color: var(--secondary);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    
    .form-group input.error,
    .form-group textarea.error {
        border-color: var(--danger);
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    /* Кнопки */
    .btn-primary, .btn-outline {
        padding: 14px 30px;
        border-radius: var(--border-radius);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        text-decoration: none;
        display: inline-block;
        text-align: center;
        font-size: 1rem;
        border: none;
    }
    
    .btn-primary {
        background: var(--secondary);
        color: white;
    }
    
    .btn-primary:hover {
        background: var(--secondary-dark);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }
    
    .btn-outline {
        background: white;
        color: var(--secondary);
        border: 2px solid var(--secondary);
    }
    
    .btn-outline:hover {
        background: var(--secondary);
        color: white;
        transform: translateY(-2px);
    }
    
    .btn-primary:disabled,
    .btn-primary[disabled] {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
    }
    
    /* Сообщения об ошибках */
    .error-message {
        color: var(--danger);
        font-size: 0.85rem;
        margin-top: 5px;
        display: none;
    }
    
    .error-message.show {
        display: block;
    }
    
    /* Подсказки */
    .form-hint {
        font-size: 0.85rem;
        color: var(--gray);
        margin-top: 5px;
    }
    
    /* Адаптивность для мобильных */
    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .checkout-form-section {
            padding: 20px;
        }
        
        .btn-primary, .btn-outline {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .form-actions {
            flex-direction: column;
        }
        
        .checkout-item {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .item-image {
            width: 100%;
            height: 150px;
            margin-right: 0;
            margin-bottom: 15px;
        }
        
        .item-details {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .item-total {
            align-self: flex-end;
        }
    }
    
    /* Анимации */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .checkout-form-section {
        animation: fadeIn 0.5s ease-out;
    }
    
    /* Стили для загрузки */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        display: none;
    }
    
    .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid var(--light);
        border-top: 5px solid var(--secondary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Стили для статусов */
    .status {
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        display: inline-block;
    }
    
    .status.processing {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }
    
    .status.completed {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    
    .status.cancelled {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    
    /* Стили для обязательных полей */
    .required::after {
        content: " *";
        color: var(--danger);
    }
    
    /* Стили для иконок в полях */
    .form-group.with-icon {
        position: relative;
    }
    
    .form-group.with-icon i {
        position: absolute;
        left: 15px;
        top: 42px;
        color: var(--gray);
    }
    
    .form-group.with-icon input {
        padding-left: 45px;
    }
    
    /* Стили для чекбоксов */
    .checkbox-group {
        display: flex;
        align-items: center;
        margin: 15px 0;
    }
    
    .checkbox-group input[type="checkbox"] {
        width: auto;
        margin-right: 10px;
    }
    
    /* Стили для радио-кнопок */
    .radio-group {
        display: flex;
        gap: 20px;
        margin: 15px 0;
    }
    
    /* Стили для выпадающих списков */
    .select-wrapper {
        position: relative;
    }
    
    .select-wrapper::after {
        content: "▼";
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
        pointer-events: none;
    }
    
    select {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        cursor: pointer;
    }
    
    /* Стили для промокода */
    .promo-section {
        display: flex;
        gap: 10px;
        margin: 20px 0;
    }
    
    .promo-section input {
        flex: 1;
    }
    
    /* Стили для доставки */
    .delivery-options {
        margin: 20px 0;
    }
    
    .delivery-option {
        display: flex;
        align-items: center;
        padding: 15px;
        border: 2px solid var(--light);
        border-radius: var(--border-radius);
        margin-bottom: 10px;
        cursor: pointer;
        transition: var(--transition);
    }
    
    .delivery-option:hover,
    .delivery-option.active {
        border-color: var(--secondary);
        background: rgba(52, 152, 219, 0.05);
    }
    
    .delivery-option input {
        margin-right: 15px;
    }
    
    .delivery-info {
        margin-left: auto;
        font-weight: bold;
        color: var(--secondary);
    }
    
    /* Стили для календаря */
    .date-picker {
        position: relative;
    }
    
    .date-picker input {
        background: white url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%23666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></rect></svg>') no-repeat right 15px center;
        background-size: 20px;
    }
    
    /* Стили для уведомлений */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        z-index: 1001;
        animation: slideIn 0.3s ease-out;
        display: none;
    }
    
    .notification.success {
        background: var(--success);
        color: white;
    }
    
    .notification.error {
        background: var(--danger);
        color: white;
    }
    
    .notification.warning {
        background: var(--warning);
        color: white;
    }
    
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    /* Стили для миниатюр товаров */
    .item-image.mini {
        width: 50px;
        height: 50px;
        min-width: 50px;
    }

    /* Исправленные стили для этапов оплаты */
    
    .checkout-steps {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 80px;
        margin: 40px 0 60px;
        position: relative;
    }
    
    .checkout-steps::before {
        content: '';
        position: absolute;
        top: 25px;
        left: 50px;
        right: 50px;
        height: 3px;
        background: var(--light);
        z-index: 1;
    }
    
    .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
        color: var(--gray);
        transition: all 0.3s ease;
    }
    
    .step-number {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: white;
        border: 3px solid var(--light);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2rem;
        margin-bottom: 15px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .step-text {
        font-size: 0.9rem;
        font-weight: 600;
        text-align: center;
        max-width: 120px;
        line-height: 1.3;
        transition: all 0.3s ease;
    }
    
    /* Активный шаг */
    .step.active {
        color: var(--dark);
    }
    
    .step.active .step-number {
        background: var(--secondary);
        border-color: var(--secondary);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    }
    
    .step.active .step-text {
        color: var(--secondary);
        font-weight: 700;
    }
    
    /* Завершенный шаг */
    .step.completed {
        color: var(--success);
    }
    
    .step.completed .step-number {
        background: var(--success);
        border-color: var(--success);
        color: white;
    }
    
    .step.completed .step-text {
        color: var(--dark);
    }
    
    /* Иконки для завершенных шагов */
    .step.completed .step-number::after {
        content: '✓';
        font-size: 1.3rem;
        font-weight: bold;
    }
    
    /* Адаптивность */
    @media (max-width: 992px) {
        .checkout-steps {
            gap: 40px;
        }
        
        .checkout-steps::before {
            left: 30px;
            right: 30px;
        }
    }
    
    @media (max-width: 768px) {
        .checkout-steps {
            flex-direction: column;
            gap: 30px;
            align-items: flex-start;
            margin: 30px 0 40px;
            padding-left: 30px;
        }
        
        .checkout-steps::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 25px;
            width: 3px;
            height: auto;
            background: var(--light);
        }
        
        .step {
            flex-direction: row;
            align-items: center;
            gap: 20px;
            width: 100%;
        }
        
        .step-number {
            width: 50px;
            height: 50px;
            margin-bottom: 0;
            flex-shrink: 0;
        }
        
        .step-text {
            text-align: left;
            max-width: none;
            font-size: 1rem;
        }
    }
    
    @media (max-width: 576px) {
        .checkout-steps {
            padding-left: 20px;
        }
        
        .step-number {
            width: 45px;
            height: 45px;
            font-size: 1.1rem;
        }
        
        .step-text {
            font-size: 0.95rem;
        }
    }
    
    /* Альтернативный вариант с цветным фоном */
    .checkout-header {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 30px;
        border-radius: var(--border-radius);
        margin-bottom: 40px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    /* Дополнительная подсветка текущего шага */
    .step.active .step-text {
        position: relative;
        padding-top: 5px;
    }
    
    .step.active .step-text::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 30px;
        height: 4px;
        background: var(--secondary);
        border-radius: 2px;
    }
    
    @media (max-width: 768px) {
        .step.active .step-text::after {
            display: none;
        }
    }
    
    /* Анимация при смене шага */
    .step-number {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .step.active .step-number {
        animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.4);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(52, 152, 219, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(52, 152, 219, 0);
        }
    }

    
    /* Стили для соглашений */
    .agreement-text {
        font-size: 0.9rem;
        color: var(--gray);
        line-height: 1.5;
        margin-top: 20px;
        padding: 15px;
        background: var(--light-gray);
        border-radius: var(--border-radius);
    }
    
    /* Стили для QR-кода (если будет) */
    .qr-code {
        text-align: center;
        margin: 20px 0;
    }
    
    .qr-code img {
        max-width: 200px;
        height: auto;
    }
    
    /* Стили для возврата на предыдущий шаг */
    .back-link {
        display: inline-flex;
        align-items: center;
        color: var(--secondary);
        text-decoration: none;
        font-weight: 500;
        margin-bottom: 20px;
    }
    
    .back-link i {
        margin-right: 8px;
    }
    
    .back-link:hover {
        text-decoration: underline;
    }
        .checkout-header {
            margin-bottom: 40px;
        }
        
        .checkout-steps {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--gray);
        }
        
        .step.active {
            color: var(--secondary);
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .step.active .step-number {
            background: var(--secondary);
            color: white;
        }
        
        .checkout-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 40px;
            margin-bottom: 60px;
        }
        
        .checkout-form-section {
            background: white;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        .checkout-summary {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            align-self: start;
        }
        
        .checkout-items {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .checkout-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--light);
        }
        
        .item-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            margin-right: 15px;
        }
        
        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-details h4 {
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .item-price {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .item-total {
            font-weight: bold;
        }
        
        .checkout-totals {
            border-top: 2px solid var(--light);
            padding-top: 20px;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .total-final {
            font-size: 1.2rem;
            font-weight: bold;
            border-top: 1px solid var(--light);
            padding-top: 15px;
            margin-top: 15px;
        }
        
        .payment-methods {
            margin: 30px 0;
        }
        
        .payment-method {
            margin-bottom: 15px;
        }
        
        .payment-method input {
            display: none;
        }
        
        .payment-method label {
            display: flex;
            align-items: center;
            padding: 20px;
            border: 2px solid var(--light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .payment-method input:checked + label {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.1);
        }
        
        .payment-method i {
            font-size: 1.5rem;
            color: var(--secondary);
            margin-right: 15px;
        }
        
        .card-payment-form {
            background: var(--light-gray);
            padding: 30px;
            border-radius: var(--border-radius);
            margin: 30px 0;
        }
        
        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .order-confirmation {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }
        
        .confirmation-icon {
            font-size: 5rem;
            color: var(--success);
            margin-bottom: 30px;
        }
        
        .order-details {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: left;
            margin: 30px 0;
        }
        
        .confirmation-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
        }
        
        @media (max-width: 992px) {
            .checkout-container {
                grid-template-columns: 1fr;
            }
            
            .checkout-steps {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            
            .confirmation-actions {
                flex-direction: column;
            }
        }
    </style>
</body>
</html>